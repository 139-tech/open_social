{{ attach_library('socialbase/teaser') }}
{{ attach_library('socialbase/page-node') }}

{% set classes = [
  'teaser',
  view_mode == 'teaser' ? 'card',
  view_mode == 'activity' ? 'teaser--stream',
  view_mode == 'activity_comment' ? 'teaser--stream',
  node.isPromoted() ? 'promoted',
  node.isSticky() ? 'sticky',
  not node.isPublished() ? 'teaser--unpublished',
  no_image ? 'no-image'
] %}

<div{{ attributes.addClass(classes) }}>
  {% if status_label %}
    <div class="node--unpublished__label">
      {{ status_label }}
    </div>
  {% endif %}

  <div class='teaser__image'>

    {% if no_image %}
      {% block card_teaser_type %}
        <a href="{{ url }}">
          <div class="teaser__teaser-type">
            <svg class="teaser__teaser-type-icon">
              <use xlink:href="#icon-{{- node.bundle|clean_class -}}"></use>
            </svg>
          </div>
        </a>
      {% endblock %}
    {% endif %}

    {# allows for new content types to just use the plain field_image name #}
    {% block card_image %}
      {{ content.field_event_image }}
      {{ content.field_topic_image }}
      {{ content.field_page_image }}
      {{ content.field_book_image }}
      {{ content.field_image }}
    {% endblock %}

  </div>

  <div class='teaser__body'>
    <div class="teaser__content">
      {{ title_prefix }}
      {% if not page %}
        <h4{{ title_attributes }} class="teaser__title">
          <a href="{{ url }}" rel="bookmark">{{ label }}
            {% if resource_library %}
              <span class="organization-tag"></span>
            {% endif %}</a>
        </h4>
      {% endif %}
      {{ title_suffix }}

      {% block card_body %}

        {% embed "node--teaser__field.html.twig" %}
          {%- block field_icon -%} account_circle {%- endblock -%}
          {%- block field_value %}
            <div class="teaser__published">
              <div class="teaser__published-author"> {{ author_name }} &bullet;</div>
              <div class="teaser__published-date"> {{ date }}</div>
            </div>
          {%- endblock -%}
        {% endembed %}

        {% if content.group_name %}
          {% embed "node--teaser__field.html.twig" %}
            {%- block field_icon -%} group {%- endblock -%}
            {%- block field_value -%} {{ content.group_name }} {%- endblock -%}
          {% endembed %}
        {% endif %}

        {% embed "node--teaser__body.html.twig" %}
          {% block field_body %} {{ content.body }} {% endblock %}
        {% endembed %}

      {% endblock %}
    </div>

    <div class="card__actionbar">
      <div class="card__actionbar-side">
        <div class="teaser__tag">
          {{ content_type }}
        </div>

        {% if comment_count > 0 %}
          <a href="{{ url }}#section-comments" class="badge teaser__badge" title="{% trans %}Total amount of comments{% endtrans %}">
              <span class="badge__container">
                <svg class="badge__icon">
                  <use xlink:href="#icon-comment"></use>
                </svg>
                <span class="badge__label">{{ comment_count }}</span>
              </span>
          </a>
        {% endif %}

        {% if likes_count is not empty %}
          <div class="badge teaser__badge" title="{% trans %}Total amount of likes{% endtrans %}">
            <span class="badge__container">
              <svg class="badge__icon">
                <use xlink:href="#icon-liked"></use>
              </svg>
              <span class="badge__label">
                {{ likes_count }}
              </span>
            </span>
          </div>
        {% endif %}

        {% if content.enrolled %}
          <span class="badge badge-secondary teaser__badge">
              {%- trans -%} You have enrolled {%- endtrans -%}
            </span>
        {% endif %}
      </div>

      {{ content.links }}
    </div>

  </div>

</div>

{% if view_mode == 'activity' and content.field_book_comments %}
  {{ content.field_book_comments }}
{% endif %}
